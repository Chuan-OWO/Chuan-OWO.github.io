<script>
  AFRAME.registerComponent('gesture-handler', {
    schema: {
      enabled: { default: true },
      rotationFactor: { default: 5 },
      scaleFactor: { default: 2 }
    },
    init: function () {
      this.handleRotation = this.handleRotation.bind(this);
      this.handlePinch = this.handlePinch.bind(this);

      this.el.sceneEl.addEventListener('onefingermove', this.handleRotation);
      this.el.sceneEl.addEventListener('twofingermove', this.handlePinch);
    },
    handleRotation: function (event) {
      if (!this.data.enabled) return;
      const rotation = this.el.getAttribute('rotation');
      this.el.setAttribute('rotation', {
        x: rotation.x,
        y: rotation.y + event.detail.positionChange.x * this.data.rotationFactor,
        z: rotation.z
      });
    },
    handlePinch: function (event) {
      if (!this.data.enabled) return;
      const scale = this.el.getAttribute('scale');
      const scaleChange = event.detail.spreadChange / 200; // 調整靈敏度
      const newScale = {
        x: scale.x + scaleChange,
        y: scale.y + scaleChange,
        z: scale.z + scaleChange
      };
      // 防止縮放過小或過大
      const clampedScale = {
        x: Math.max(0.1, Math.min(5, newScale.x)),
        y: Math.max(0.1, Math.min(5, newScale.y)),
        z: Math.max(0.1, Math.min(5, newScale.z))
      };
      this.el.setAttribute('scale', clampedScale);
    }
  });

  document.querySelector('#gesture-model').setAttribute('gesture-handler', '');
</script>
